;(function(csp,$){csp.RegisterView=Backbone.View.extend({events:{'blur input:not([type="submit"])':'blur'},ajax:function(options){if(this.xhr)this.xhr.abort();this.xhr=$.ajax($.extend({url:this.$el.attr('action'),xhrFields:{withCredentials:true},method:'POST'},options));return this.xhr;},initialize:function(){this.$('[data-toggle="tooltip"]').tooltip({placement:'right',trigger:'focus'});},validate:function(errors){_.each(errors,function(error,name){var $fg=this.$('#id_'+name+'_fg'),msg=error[0].message;$fg.find('span.help-block').remove();$fg.find('input').feedback('error');$fg.append($('<span/>').addClass('help-block').text(msg));},this);},blur:function(event){var $input=this.$(event.currentTarget),name=$input.attr('name');$input.closest('.form-group').find('span.help-block').remove();$input.feedback();if($input.val()){$input.feedback('loading');this.ajax({data:this.$el.serializeObject(),success:_.bind(function(data){if(data.errors&&_.has(data.errors,name)){this.validate(_.pick(data.errors,name));}else{$input.feedback('success');}},this)});}}});})(window.canstockphoto=window.canstockphoto||{},jQuery);;(function(csp,$){csp.RegisterModalView=csp.RegisterView.extend({account_created:false,events:_.extend(csp.RegisterView.prototype.events,{'hide.bs.modal':'hide','submit':'submit'}),initialize:function(options){csp.RegisterView.prototype.initialize.apply(this,arguments);this.$el.modal('show');},submit:function(){this.$el.addClass('loading');this.ajax({data:_.extend({'create':true},this.$el.serializeObject()),success:_.bind(function(data){this.$el.removeClass('loading');if(data.errors){this.validate(data.errors);}else{this.account_created=true;var $name=$('<span/>').html(interpolate(gettext('Welcome, %(name)s!'),{'name':data.first_name},true));var $msg=$('<small/>').addClass('text-orange').html(' &nbsp; '+gettext("We're happy to have you"));this.$('.modal-title').empty().append($name,$msg);this.$('div.registration-complete').show();this.$('div.registration-form').hide();this.$el.css('max-height','100%');this.$('.modal-footer').hide();}},this)});return false;},hide:function(){if(this.account_created)location.reload();}});})(window.canstockphoto=window.canstockphoto||{},jQuery);